# Zora - 更新日志

本文档记录Zora项目的所有重要变更。

## [1.1.0] - 2025-01-21

### 新增功能

#### AI集成
- 实现AI驱动的聊天助手，提供智能客服服务
- 添加专为客服操作定制的AI工具（客户画像查询、订单查询等）
- 实现提示词工程，优化AI响应质量
- 添加AI流式响应支持，提升用户体验
- 集成客户画像和订单数据，实现上下文感知的AI响应
- 支持多种AI提供商（OpenAI、阿里云通义千问等）

#### 客户画像增强
- 添加全面的客户画像系统，多维度分析客户
- 实现客户价值评分（0-100），评估客户商业价值
- 实现客户忠诚度评分（0-100），衡量客户忠诚程度
- 实现客户参与度评分（0-100），反映客户活跃程度
- 添加客户行为分析，了解客户互动模式
- 添加购买模式分析，识别购买周期和趋势
- 添加产品偏好跟踪，了解客户喜好
- 添加配送地点分析，优化物流策略

#### UI/UX改进
- 增强客户画像显示，提供详细分析和可视化
- 改进消息状态指示器，清晰显示发送、送达、已读状态
- 添加实时输入指示器，提升对话体验
- 增强移动端响应性，优化移动设备使用体验
- 添加加载状态和骨架屏，提升用户体验
- 优化聊天界面布局，提高信息展示效率

### 技术改进

- 添加IndexedDB持久化，支持离线功能
- 改进错误处理和日志记录，增强系统稳定性
- 增强Socket.IO连接稳定性，减少连接中断
- 优化AI响应缓存，提高响应速度
- 改进数据库查询性能，优化索引和查询语句
- 实现请求拦截器，统一处理请求和响应
- 优化WebSocket重连机制，提高连接恢复速度

### Bug修复

- 修复AI流式响应中断问题
- 修复客户画像数据同步延迟问题
- 修复消息状态更新不及时的问题
- 改进WebSocket重连逻辑，提高重连成功率
- 修复离线消息推送失败的问题
- 修复客服离线时聊天列表保存失败的问题

## [1.0.0] - 2025-01-20

### 新增功能

#### 实时客服系统
- 实现基于Socket.IO的实时消息通信系统，支持WebSocket和长轮询
- 支持多客服同时在线，自动分配和管理客服连接
- 实现客户上线自动创建/恢复会话功能
- 添加消息状态追踪（发送、送达、已读），实时更新状态
- 实现离线消息存储和推送功能，确保消息不丢失
- 支持客服手动离线，自动保存聊天列表

#### 数据同步
- 实现Shopify订单数据实时同步（创建、更新、删除）
- 实现Shopify客户数据实时同步（创建、更新、删除）
- 实现Shopify产品数据实时同步（创建、更新、删除）
- 添加Webhook事件监听和处理，支持HMAC签名验证
- 实现Webhook事件实时推送给在线客服
- 使用Redis缓存同步数据，减少数据库查询
- 支持应用卸载时清理相关数据

#### 客户管理
- 实现客户信息查询和展示
- 添加客户搜索功能
- 实现客户标签系统
- 添加客户订单查看功能
- 实现全面的客户画像，包括价值、忠诚度和参与度评分
- 添加客户行为、偏好和购买模式分析

#### 安全与认证
- 实现JWT身份验证
- 添加邮箱验证码登录功能
- 使用bcrypt进行密码加密
- 实现多级请求限流机制
- 添加所有Shopify Webhook事件的HMAC签名验证
- 实现使用Redis的安全会话管理

#### API接口
- 实现用户认证接口
- 实现客户管理接口
- 实现订单查询接口
- 实现产品查询接口
- 实现消息发送和历史消息查询接口

#### 后台服务
- 实现日志Worker，统一管理应用日志
- 实现Shopify Worker，处理Shopify相关任务
- 添加Worker健康检查机制
- 实现任务队列管理（BullMQ）
- 添加消息Worker，处理离线消息

### 技术改进

- 使用React Router 7重构应用路由
- 全面采用TypeScript，增强类型安全
- 使用Zustand进行状态管理，支持IndexedDB持久化
- 使用Prisma作为ORM工具
- 使用PostgreSQL作为主数据库
- 使用Redis进行缓存和会话管理
- 集成OpenAI SDK，提供AI智能客服
- 实现Winston日志系统，支持日志轮转

### 性能优化

- 实现Redis缓存，减少数据库查询
- 优化Socket.IO连接管理
- 实现请求拦截和错误处理
- 添加数据同步优化机制

### Bug修复

- 修复Socket.IO连接断开重连问题
- 修复Webhook验证失败问题
- 修复离线消息推送问题
- 修复客户会话状态不同步问题
- 修复Worker健康检查失败问题
- 修复AI集成流式响应问题